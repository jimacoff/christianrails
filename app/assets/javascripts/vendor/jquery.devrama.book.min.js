/**
 * Devrama-Book Version 0.9.0
 * Developed by devrama.com
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/mit-license.php
 *
 */

$(function(){var g=function(a,b){this.ready=!1;this.current_page_index=this.num_page_papers=0;this.$book=void 0;this.is_open=this.on_animation=!1;this.page_content=[];this.options={width:400,height:500,depth:50,cover_thickness:2,speed_page_turn:700,init_degree:-35};$.extend(this.options,b);this.$element=$(a)};g.prototype={_init:function(){var a=this;this._prepare(function(){a.ready=!0})},_prepare:function(a){var b=this;this.$element.css({width:this.options.width,height:this.options.height});this.$element.children("ul.page").children("li").each(function(a){b.page_content.push($(this).clone())});
a='<li class="front"></li>';var c='\t\t\t\t\t\t\t<li class="top"></li>\t\t\t\t\t\t\t<li class="bottom"></li>\t\t\t\t\t\t\t<li class="left"></li>\t\t\t\t\t\t\t<li class="right"></li>\t\t\t\t\t\t',d='\t\t\t\t\t\t\t<li class="top"></li>\t\t\t\t\t\t\t<li class="bottom"></li>\t\t\t\t\t\t\t<li class="left"></li>\t\t\t\t\t\t\t<li class="right"></li>\t\t\t\t\t\t';0<this.$element.find("ul.spine li.front").length&&(a=$("<div>").append(this.$element.find("ul.spine li.front").clone()).html());c=0<this.$element.find("ul.front li.front").length?
c+$("<div>").append(this.$element.find("ul.front li.front").clone()).html():c+'<li class="front"></li>';c=0<this.$element.find("ul.front li.back").length?c+$("<div>").append(this.$element.find("ul.front li.back").clone()).html():c+'<li class="back"></li>';d=0<this.$element.find("ul.back li.front").length?d+$("<div>").append(this.$element.find("ul.back li.front").clone()).html():d+'<li class="front"></li>';d=0<this.$element.find("ul.back li.back").length?d+$("<div>").append(this.$element.find("ul.back li.back").clone()).html():
d+'<li class="back"></li>';this.$element.html('\t\t\t\t<div class="book">\t\t\t\t\t<ul class="spine">\t\t\t\t\t'+a+'\t\t\t\t\t</ul>\x3c!-- .spine --\x3e\t\t\t\t\t<ul class="front">\t\t\t\t\t'+c+'\t\t\t\t\t</ul>\x3c!-- .front --\x3e\t\t\t\t\t<ul class="back">\t\t\t\t\t'+d+"\t\t\t\t\t</ul>\t\t\t\t</div>\x3c!-- .book --\x3e\t\t\t\t\t\t\t\t");this.$book=this.$element.children(".book");this.$cover_front=this.$book.children("ul.front");this.$cover_back=this.$book.children("ul.back");this.$book.css({width:this.options.width,
height:this.options.height});this._buildSpine();this._buildCover(!0);this._buildCover(!1);var e=[];this.$element.find("img").each(function(){e.push($(this).attr("src"))});this._addBlankPages();a={"-webkit-transition":"-webkit-transform "+this.options.speed_page_turn+"ms ease ","-moz-transition":"-moz-transform "+this.options.speed_page_turn+"ms ease ","-o-transition":"-o-transform "+this.options.speed_page_turn+"ms ease ",transition:"transform "+this.options.speed_page_turn+"ms ease "};this.$cover_front.css(a);
this.$book.css($.extend(a,{transform:"rotateY("+this.options.init_degree+"deg)"}));this.$cover_front.on("click",function(){!1===b.on_animation&&!1===b.is_open&&b._openBook()});$(window).on("keydown",function(a){if(!0!==b.on_animation)switch(a.which){case 33:case 37:case 109:!0===b.is_open&&b._previous();break;case 34:case 39:case 107:!0===b.is_open?b._next():b._openBook()}})},open:function(){!1===this.on_animation&&!1===this.is_open&&this._openBook()},close:function(){!1===this.on_animation&&!0===
this.is_open&&this._closeBook()},previous:function(){!1===this.on_animation&&!0===this.is_open&&this._previous()},next:function(){!1===this.on_animation&&(!0===this.is_open?this._next():this._openBook())},_buildSpine:function(){this.$book.find("ul.spine li.front").css({width:this.options.depth+"px"})},_buildCover:function(a){var b=void 0,b=a?this.$cover_front:this.$cover_back,c=b.outerWidth(),d=b.outerHeight(),e=0;"undefined"!=typeof a&&!1==a&&(e=-1*(this.options.depth+this.options.cover_thickness),
b.css({transform:"translateZ("+e+"px)"}));b.children(".back").css({transform:"translateZ("+-1*this.options.cover_thickness+"px) rotateY(180deg) translateX(-100%)"});b.children(".top").css({height:this.options.cover_thickness+"px",transform:"translateZ("+-1*this.options.cover_thickness+"px) rotateX(90deg)"});b.children(".bottom").css({height:this.options.cover_thickness+"px",transform:"translateY("+d+"px) rotateX(-90deg)"});b.children(".left").css({height:"100%",width:this.options.cover_thickness+
"px",transform:"translateZ("+-1*this.options.cover_thickness+"px) rotateY(-90deg)"});b.children(".right").css({height:"100%",width:this.options.cover_thickness+"px",transform:"translateX("+c+"px) rotateY(90deg)"})},_addBlankPages:function(a){a=Math.floor(this.options.depth/5);for(var b=void 0,c=0;c<a;c++)b=$('\t\t\t\t<ul class="page">\t\t\t\t\t<li class="front"></li>\t\t\t\t\t<li class="back"></li>\t\t\t\t</ul>\x3c!-- .page --\x3e\t\t\t\t').appendTo(this.$book),b.attr("data-page-num",c),b.css({transform:"translateZ("+
(-5*c-1-this.options.cover_thickness)+"px)"})},_getEndEvent:function(a){var b=["webkit","Moz","Ms","o","Khtml"];if(a in document.body.style)return a+"end";a=a.charAt(0).toUpperCase()+a.slice(1);for(var c=0;c<b.length;c++)if(b[c]+a in document.body.style)return b[c]+a+"End";return!1},_openBook:function(){this.is_open=this.on_animation=!0;for(var a=this,b=this._getEndEvent("transition"),c={"-webkit-transition":"-webkit-transform "+this.options.speed_page_turn+"ms ease ","-moz-transition":"-moz-transform "+
this.options.speed_page_turn+"ms ease ","-o-transition":"-o-transform "+this.options.speed_page_turn+"ms ease ",transition:"transform "+this.options.speed_page_turn+"ms ease "},d=void 0,e=0;3>e;e++)d=$('\t\t\t\t<ul class="page stack">\t\t\t\t\t<li class="front shadow"></li>\t\t\t\t\t<li class="back shadow"></li>\t\t\t\t</ul>\x3c!-- .stack --\x3e\t\t\t\t').appendTo(this.$book),0==e?d.addClass("left ztop"):1==e?d.addClass("right zmiddle"):2==e&&d.addClass("ready zbottom"),d.css(c);a.page_content[0]&&
(a.page_content[0].addClass("front shadow"),a.$book.find("ul.stack.left li.front").replaceWith(a.page_content[0]),a.page_content[1]&&(a.page_content[1].addClass("back shadow"),a.$book.find("ul.stack.left li.back").replaceWith(a.page_content[1])),a.page_content[2]&&(a.page_content[2].addClass("front shadow"),a.$book.find("ul.stack.right li.front").replaceWith(a.page_content[2])),a.page_content[3]&&(a.page_content[3].addClass("back shadow"),a.$book.find("ul.stack.right li.back").replaceWith(a.page_content[3])));
this.current_page_index=2;this.$book.css({transform:"rotateY(0deg)"});this.$book.one(b,function(){a.$cover_front.addClass("turn");a.$cover_front.one(b,function(){a.$cover_front.css("z-index",99);a.$book.children(".stack.left").addClass("turn");a.$book.children(".stack.left").one(b,function(){a.$book.css({"-webkit-transform-style":"flat","-moz-transform-style":"flat","-o-transform-style":"flat","transform-style":"flat",transform:""});var b=a.$book.children("ul.stack.right"),c=a.$book.children("ul.stack.left"),
d=a.$book.children("ul.stack.ready");c.off();b.off();d.off();c.on("click",function(){a._previous()});b.on("click",function(){a._next()});a.on_animation=!1})})})},_closeBook:function(){this.on_animation=!0;this.is_open=!1;var a=this,b=this._getEndEvent("transition");this.$book.css({"-webkit-transform-style":"preserve-3d","-moz-transform-style":"preserve-3d","-o-transform-style":"preserve-3d","transform-style":"preserve-3d"});this.$book.css({transform:"rotateY("+this.options.init_degree+"deg)"});var c=
this.$element.find("ul.stack.left");c.removeClass("turn");c.one(b,function(){a.$cover_front.css("z-index","");a.$cover_front.removeClass("turn");a.$cover_front.one(b,function(){a.$element.find("ul.stack").remove();a.on_animation=!1;a.current_page_index=0})})},_next:function(){var a=this,b=this._getEndEvent("transition"),c=this.current_page_index+1;if(this.page_content[c]){this.on_animation=!0;var d=a.$book.children("ul.stack.right"),e=a.$book.children("ul.stack.left"),f=a.$book.children("ul.stack.ready");
e.off();d.off();f.off();d.addClass("ztop").removeClass("zmiddle");e.addClass("zbottom").removeClass("ztop");f.addClass("zmiddle").removeClass("zbottom");a.page_content[c+1]?(a.page_content[c+1].addClass("front shadow"),f.children("li.front").replaceWith(a.page_content[c+1]),a.page_content[c+2]&&(a.page_content[c+2].addClass("back shadow"),f.children("li.back").replaceWith(a.page_content[c+2]))):(f.children("li.front").replaceWith('<li class="front shadow"></li>'),f.children("li.back").replaceWith('<li class="back shadow"></li>'));
e.addClass("leftpush1px");d.addClass("turn");d.one(b,function(){e.remove();$('\t\t\t\t\t<ul class="page stack ready zbottom">\t\t\t\t\t\t<li class="front shadow"></li>\t\t\t\t\t\t<li class="back shadow"></li>\t\t\t\t\t</ul>\x3c!-- .stack --\x3e\t\t\t\t\t').appendTo(a.$book).css({"-webkit-transition":"-webkit-transform "+a.options.speed_page_turn+"ms ease ","-moz-transition":"-moz-transform "+a.options.speed_page_turn+"ms ease ","-o-transition":"-o-transform "+a.options.speed_page_turn+"ms ease ",
transition:"transform "+a.options.speed_page_turn+"ms ease "});d.addClass("left").removeClass("right");f.addClass("right").removeClass("ready");d.on("click",function(){a._previous()});f.on("click",function(){a._next()});a.current_page_index+=2;a.on_animation=!1})}},_previous:function(){var a=this,b=this._getEndEvent("transition"),c=this.current_page_index-2;if(2>=this.current_page_index)this._closeBook();else{this.on_animation=!0;var d=a.$book.children("ul.stack.right"),e=a.$book.children("ul.stack.left"),
f=a.$book.children("ul.stack.ready");e.off();d.off();f.off();a.page_content[c-2].addClass("front shadow");f.children("li.front").replaceWith(a.page_content[c-2]);a.page_content[c-1].addClass("front shadow");f.children("li.back").replaceWith(a.page_content[c-1]);f.css({"-webkit-transition":"","-moz-transition":"","-o-transition":"",transition:""});f.addClass("turn");d.removeClass("zmiddle").addClass("rightpush1px zbottom");e.removeClass("turn ztop").addClass("zmiddle");e.one(b,function(){d.remove();
var b=$('\t\t\t\t\t<ul class="page stack ready zbottom">\t\t\t\t\t\t<li class="front shadow"></li>\t\t\t\t\t\t<li class="back shadow"></li>\t\t\t\t\t</ul>\x3c!-- .stack --\x3e\t\t\t\t\t').appendTo(a.$book),c={"-webkit-transition":"-webkit-transform "+a.options.speed_page_turn+"ms ease ","-moz-transition":"-moz-transform "+a.options.speed_page_turn+"ms ease ","-o-transition":"-o-transform "+a.options.speed_page_turn+"ms ease ",transition:"transform "+a.options.speed_page_turn+"ms ease "};b.css(c);
f.css(c);f.addClass("left ztop").removeClass("ready zbottom");e.addClass("right").removeClass("left");f.on("click",function(){a._previous()});e.on("click",function(){a._next()});a.current_page_index-=2;a.on_animation=!1})}}};$.fn.DrBook=function(a){if("string"===typeof a){var b=$(this),c=b.data("DrBook");c||b.data("DrBook",c=new g(this,a));return c[a].apply(c,Array.prototype.slice.call(arguments,1))}return this.each(function(){var b=$(this),c=b.data("DrBook");c||b.data("DrBook",c=new g(this,a));c._init()})};
$.fn.DrBook.prototype.constructor=g});
